<!DOCTYPE html>
<html>
<head>
<!-- JQuery -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

<!-- Bootstrap -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>
<body>
<div id="landingPage">
	<div style="float:right;"><button onclick="initiateApplication();">Initiate Application</button></div><br>
	<div id="pendingApplicationsTable" style="margin-top:35px;">
		<div style="text-align:center;font-size:35px;">Pending Applications</div>	
	</div>
	<div id="submittedApplicationsTable" style="margin-top:35px;">
		<div style="text-align:center;font-size:35px;">Submitted Applications</div>	
	</div>
	<div id="completedApplicationsTable" style="margin-top:35px;">
		<div style="text-align:center;font-size:35px;">Completed Applications</div>	
	</div>
</div>
<div id="initiatePage">
	<div style="text-align:center;font-size:35px;">Initiate Application</div>
	<div style="text-align:right;margin-top:50px;width:58%;"><label style="margin-right:10px;"><b>First Name:</b></label><input id="first_name" type="text"></div>
	<div style="text-align:right;margin-top:20px;width:58%;"><label style="margin-right:10px;"><b>Last Name:</b></label><input id="last_name" type="text"></div>
	<div style="text-align:right;margin-top:20px;width:58%;"><label style="margin-right:10px;"><b>Phone Number:</b></label><input id="primary_phone_number" type="text">		</div>
	<div style="text-align:right;margin-top:20px;width:58%;"><label style="margin-right:10px;"><b>Email:</b></label><input id="primary_email" type="text"></div>
	<div style="text-align:center;margin-top:20px"><button onclick="initiateNewApplicant();">Initiate</button></div>
	<div style="text-align:center;margin-top:20px"><button id="cancel">Cancel</button></div>
</div>
<div id="editPage">
	<div style="text-align:center;font-size:35px;">Edit Application</div>
	<div style="text-align:right;margin-top:50px;width:58%;"><label style="margin-right:10px;"><b>Name:</b></label><input id="edit_name" type="text"></div>
	<div style="text-align:right;margin-top:20px;width:58%;"><label style="margin-right:10px;"><b>Phone Number:</b></label><input id="edit_primary_phone_number" type="text"></div>
	<div style="text-align:right;margin-top:20px;width:58%;"><label style="margin-right:10px;"><b>Email:</b></label><input id="edit_primary_email" type="text"></div>
	<div style="text-align:right;margin-top:20px;width:58%;"><label style="margin-right:10px;"><b>Business Name:</b></label><input id="edit_business_name" type="text"></div>
	<div id="applicationPDF"></div>
	<div id="resendPopup" style="display:none;margin-left:550px;margin-top:250px">
		<textarea id="message" rows="4" cols="50"></textarea><br>
		<div style="text-align:center;margin-top:10px;"><button onclick="returnToClient()">Submit</button><button onclick="cancelResend();" style="margin-left:10px;">Cancel</button></div>
	</div>
	<div style="text-align:center;">
	<div style="text-align:center;margin-top:20px;display:inline-block;"><button onclick="saveApplication();">Save Application</button></div>
	<div style="text-align:center;margin-top:20px;display:inline-block;"><button onclick="markApplicationComplete();">Mark Complete</button></div>
	<!-- Trigger the modal with a button -->
	<div style="text-align:center;margin-top:20px;display:inline-block;"><button id="returnApplication" type="button" data-toggle="modal" data-target="#myModal">Return Application</button></div>
	</div>
	<div style="text-align:center;margin-top:20px"><button id="cancel">Cancel</button></div>
	<!-- Modal -->
	<div class="modal fade" id="myModal" role="dialog">
	<div class="modal-dialog">

	  <!-- Modal content-->
      <div class="modal-content" style="margin-top:100px;">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Message to Client:</h4>
        </div>
		<textarea style="width:595px;height:278px;" id="returnAppMessage"></textarea>
        <div class="modal-footer">
			<div style="float:left;"><b>Prepared Statements:</b></div><br>
			<button style="float:left;margin-right:10px;" id="returnBio">Bio</button>
			<button style="float:left;" id="returnAgreement">Agreement</button><br>
			
			<button class="btn btn-default" id="submitReturn">Submit</button>
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
	  
	</div>
	</div>
  
</div>
</body>
</html>
<style>
#resendPopup {
  width: 300px !important; 
  border: 1px solid black !important;
  padding: 50px !important;
  margin: 20px !important;
}
table, th, td 
{
  border: 1px solid black;
}
th,td
{
	width:100px;
}
.editUser
{
	background: #b8d1f3 !important;
}
.editUser:hover 
{
	background-color: #ffff99 !important;
	cursor: pointer;
}
</style>
<script>
$(document).ready(function()
{
	pendingTable();
	submittedTable();
	completedTable();
	$("#initiatePage").hide();
	$("#editPage").hide();
	$("#cancel").click(function()
  	{
		$("#initiatePage").hide();
		$("#landingPage").show();
	});
	$("#returnBio").click(function()
	{
		$("#returnAppMessage").val("");
		$("#returnAppMessage").val("Please review the Bio section in Bio.");
	});
});
function pendingTable()
{
	$.ajax
	({
		type: "POST",
		url: "applicationManagement.php",
		data:{action:"pending_table"},
		success: function(data)
		{
			$("#pendingApplicationsTable").append(data);
			var dataTable = $("#pendingTable").DataTable({
				"columnDefs": [
				{
					"targets": [6],
					"visible": false,
				},
				{
					"targets": [8],
					"visible": false,
				},
				{
					"targets": [9],
					"visible": false,
				},
				{
					"targets": [10],
					"visible": false,
				},
			]
			});
		}
	});
}
function submittedTable()
{
	$.ajax
	({
		type: "POST",
		url: "applicationManagement.php",
		data:{action:"submitted_table"},
		success: function(data)
		{
			$("#submittedApplicationsTable").append(data);
			var dataTable = $("#submittedTable").DataTable({
				"columnDefs": [
				{
					"targets": [8],
					"visible": false,
				},
				{
					"targets": [9],
					"visible": false,
				},
				{
					"targets": [10],
					"visible": false,
				},
			]
			});
			$('.editUser').click(function()
			{
				var userInfo = dataTable.row(this).data();
				editUser(userInfo);
			});
		}
	});
}
function completedTable()
{
	$.ajax
	({
		type: "POST",
		url: "applicationManagement.php",
		data:{action:"completed_table"},
		success: function(data)
		{
			$("#completedApplicationsTable").append(data);
			$("#completedTable").DataTable({
				"columnDefs": [
				{
					"targets": [8],
					"visible": false,
				},
				{
					"targets": [9],
					"visible": false,
				},
				{
					"targets": [10],
					"visible": false,
				},
			]
			});
		}
	});
}
function initiateApplication()
{
	$("#initiatePage").show();
	$("#landingPage").hide();
}
function editUser(userInfo)
{
	$("#editPage").show();
	$("#landingPage").hide();
	
	$("#edit_name").val(userInfo[1]);
	$("#edit_primary_phone_number").val(userInfo[2]);
	$("#edit_primary_email").val(userInfo[3]);
	$("#edit_business_name").val(userInfo[5]);
	$.ajax
	({
		type: "POST",
		url: "applicationManagement.php",
		data:{action:"getApplicationPDF",application_id:userInfo[0]},
		success: function(data)
		{
			$("#applicationPDF").append(data);
		}
	});	
}
function returnApplication()
{
	<!-- $('#editPage > *:not(#resendPopup)').css({ -->
	<!-- "filter" : "blur(5px)" -->
	<!-- }).appendTo("#editPage"); -->
	
	<!-- $("#resendPopup").show(); -->
	$("#test").show();
}
function cancelResend()
{
	$('#editPage > *:not(#resendPopup)').css({
	"filter" : "blur(0px)"
	}).appendTo("#editPage");
	
	$('#resendPopup').hide();
}
function saveApplication()
{
}
function initiateNewApplicant()
{
	var err = "";
	if($("#first_name").val() == "")
	{
		err += "First Name <br>";
	}
	if($("#last_name").val() == "")
	{
		err += "Last Name <br>";
	}
	if($("#primary_phone_number").val() == "")
	{
		err += "Phone Number <br>";
	}
	if($("#primary_email").val() == "")
	{
		err += "Email <br>";
	}
	if(err != "")
	{
		Swal.fire({html:'The following fields are required: <br>' + err, icon:'warning'});
	}
	else
	{
		$.ajax
		({
			type: "POST",
			url: "applicationManagement.php",
			data:{action:"initiate_application",first_name:$("#first_name").val(),last_name:$("#last_name").val(),primary_phone_number:$("#primary_phone_number").val(),primary_email:$("#primary_email").val()},
			success: function(data)
			{
				Swal.fire({html:'Application Initiated', icon:'success'}).then(function()
				{
					location.reload();
				});
			}
		});	
	}	
}
</script>