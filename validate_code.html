<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
</head>
<body>
	<div style="text-align:center;font-size:35px;margin-top:100px;"><b>Please Enter Validation Code</b></div>
	<div style="text-align:center;margin-top:20px;border-radius:25px;"><input type="text" id="verification_code"></div>
	<div style="text-align:center;margin-top:20px;"><button onclick="submitVerificationCode();" id="submitVerificationCode">Submit Validation Code</button></div>
	<div style="text-align:center;margin-top:20px;"><button onclick="validateEmailPhone();">Resend Validation Code</button></div>
	<input type="hidden" id="application_id" value="[application_id]">
	<div id="resendPopup" style="display:none;margin-left:550px;margin-top:250px">
		<div>Please Enter The Email and Phone Number Provided for this Account</div><br>
		<div style="width:90%;text-align:right;">
			<div style="display:inline-block;">Email:<input style="margin-left:4px;" id="email" type="text" ></div>
			<div style="display:inline-block;margin-top:8px;">Phone Number:<input style="margin-left:4px;" id="phone" type="text" ></div>
		</div>
		<div style="text-align:center;margin-top:10px;"><button onclick="resendVerificationCode()">Submit</button><button style="margin-left:10px;" id="cancelResend">Cancel</button></div>
	</div>
</body>
</html>
<style>
#resendPopup {
  width: 300px;
  border: 1px solid black;
  padding: 50px;
  margin: 20px;
  position: absolute
}
</style>
<script>
$(document).ready(function()
{
	$("#cancelResend").click(function()
	{
		$('body > *:not(#resendPopup)').css({
		"filter" : "blur(0px)"
		}).appendTo(document.body);
	
		$('#resendPopup').hide();
	});
});
var err = 0;
function submitVerificationCode()
{
	$.ajax
	({
		type: "POST",
		url: "applicationManagement.php",
		data:{action:"submit_verification_code",code:$("#verification_code").val()},
		success: function(data)
		{
			err++;
			var data = JSON.parse(data);
			if(data[1] == "Success")
			{
				Swal.fire({html:'Validation Code Has Been Verified.', icon:'success'}).then(function()
				{
					$.ajax
					({
						type: "POST",
						url: "clientApplication.php",
						data:{action:"run_client_application",application_id:data[0]},
						success: function(data)
						{
							<!-- return false; -->
							<!-- console.log(data); -->
							<!-- window.location.href = "http://localhost/applicationManagement/client_application.php"; -->
						}
					});
					
				});
			}
			if(data == "Error")
			{
				Swal.fire({html:'Incorrect Verification Code', icon:'error'});
				if(err >= 5)
				{
					Swal.fire({html:'The number of incorrect attempts has been exceeded. <br> Please click <b>Resend Validation Code</b>', icon:'error'}).then(function()
					{
						$("#verification_code").prop("disabled",true);
						$("#submitVerificationCode").prop("disabled",true);
						
					});
				}
			}
		}
	});
}
function validateEmailPhone()
{
	<!-- $('body').css({ -->
	<!-- "width" : "100%","height" : "100%","position" : "fixed", "top" : "0", "left" : "0", "opacity" : "0.2", "background-color" : "revert" -->
	<!-- }).appendTo(document.body); -->
	$('body > *:not(#resendPopup)').css({
	"filter" : "blur(5px)"
	}).appendTo(document.body);
	
	$('#resendPopup').show();
}
function resendVerificationCode()
{
	$.ajax
	({
		type: "POST",
		url: "applicationManagement.php",
		data:{action:"resend_verification_code",email:$("#email").val(),phone:$("#phone").val()},
		success: function(data)
		{
			console.log(data);
			if(data == "success")
			{
				Swal.fire({html:'Email has been sent out with a new verification code.', icon:'success'}).then(function()
				{
					return;
				});
			}
			else
			{
				Swal.fire({html:"Email or Phone number provided isn't <br> attached to any existing account.<br>Please try again.", icon:'warning'}).then(function()
				{
					return;
				});
			}
		}
	});
}
</script>